# Zararlı Yazılım Temizleme Script'i
# KRİTİK: Bu script şüpheli process'leri ve dosyaları temizler

$SERVER = "root@alo17.tr"
$REMOTE_PATH = "/var/www/alo17"

Write-Host "==========================================" -ForegroundColor Red
Write-Host "ZARARLI YAZILIM TEMİZLEME" -ForegroundColor Yellow
Write-Host "KRİTİK İŞLEM - DİKKATLİ OLUN!" -ForegroundColor Red
Write-Host "==========================================" -ForegroundColor Red
Write-Host ""

# 1. Şüpheli Process'i Durdur
Write-Host "1. Şüpheli process durduruluyor (vcHoibJV)..." -ForegroundColor Yellow
ssh $SERVER "kill -9 3417358 2>/dev/null && echo 'Process durduruldu' || echo 'Process bulunamadı veya zaten durmuş'" 2>&1

# 2. Şüpheli Cron Job'ı Temizle
Write-Host "`n2. Şüpheli cron job temizleniyor..." -ForegroundColor Yellow
ssh $SERVER "crontab -l | grep -v 'kworker-0-0' | crontab - && echo 'Cron job temizlendi' || echo 'Cron job bulunamadı'" 2>&1

# 3. Şüpheli Dosyaları Sil
Write-Host "`n3. Şüpheli dosyalar temizleniyor..." -ForegroundColor Yellow
ssh $SERVER "rm -rf /var/tmp/.cache/kworker-0-0 2>/dev/null && echo 'Dosya silindi' || echo 'Dosya bulunamadı'" 2>&1
ssh $SERVER "find /tmp /var/tmp -name '*vcHoibJV*' -o -name '*kworker*' -o -name '*xmrig*' -o -name '*miner*' 2>/dev/null | xargs rm -rf 2>/dev/null && echo 'Şüpheli dosyalar temizlendi' || echo 'Şüpheli dosya bulunamadı'" 2>&1

# 4. Process Kontrolü (Tekrar)
Write-Host "`n4. Process kontrolü (temizlik sonrası)..." -ForegroundColor Yellow
ssh $SERVER "ps aux | grep -E 'vcHoibJV|kworker-0-0|xmrig|miner' | grep -v grep" 2>&1

# 5. CPU Kullanımı Kontrolü
Write-Host "`n5. CPU kullanımı kontrol ediliyor..." -ForegroundColor Yellow
ssh $SERVER "top -bn1 | head -5" 2>&1

# 6. Cron Job Kontrolü
Write-Host "`n6. Cron job kontrolü..." -ForegroundColor Yellow
ssh $SERVER "crontab -l 2>/dev/null || echo 'Crontab temiz'" 2>&1

Write-Host "`n==========================================" -ForegroundColor Red
Write-Host "TEMİZLEME TAMAMLANDI" -ForegroundColor Green
Write-Host "`nSONRAKİ ADIMLAR:" -ForegroundColor Yellow
Write-Host "1. Sunucu şifresini değiştirin!" -ForegroundColor Red
Write-Host "2. SSH key'leri kontrol edin" -ForegroundColor White
Write-Host "3. Fail2ban kurun ve aktif edin" -ForegroundColor White
Write-Host "4. Firewall kurallarını kontrol edin" -ForegroundColor White
Write-Host "5. Sistem güncellemelerini yapın" -ForegroundColor White
Write-Host "==========================================" -ForegroundColor Red

