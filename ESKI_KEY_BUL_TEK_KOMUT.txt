# Eski ENCRYPTION_KEY'i bulmak için komutlar

# 1. Veritabanında şifrelenmiş telefon örnekleri:
ssh root@alo17.tr "cd /var/www/alo17 && echo 'SELECT id, name, email, phone FROM User WHERE phone IS NOT NULL AND phone != \"\" AND phone LIKE \"%:%\" LIMIT 3;' | npx prisma db execute --stdin"

# 2. .env backup dosyalarını kontrol et:
ssh root@alo17.tr "cd /var/www/alo17 && find . -maxdepth 2 -name '.env*' -o -name '*env*backup*' 2>/dev/null"

# 3. Git history'de ENCRYPTION_KEY ara:
ssh root@alo17.tr "cd /var/www/alo17 && if [ -d .git ]; then git log --all --full-history -p -- .env 2>/dev/null | grep -A 3 'ENCRYPTION_KEY' | head -20; else echo 'Git yok'; fi"

# 4. PM2 loglarında key ile ilgili mesajlar:
ssh root@alo17.tr "pm2 logs alo17 --lines 500 --nostream 2>&1 | grep -i 'encryption\|key' | tail -10"

# 5. Sunucuda tüm .env dosyalarını listele:
ssh root@alo17.tr "cd /var/www/alo17 && ls -la .env* 2>/dev/null"

