# Nginx Cache Optimizasyonu
# Bu ayarları /etc/nginx/sites-available/alo17.tr dosyasına ekleyin

# Cache zone tanımla (nginx.conf'un http bloğuna veya bu dosyaya)
# Not: Eğer nginx.conf'u düzenleyemiyorsanız, bu ayarları sites-available dosyasına ekleyin

# Cache path (nginx.conf'da tanımlanmalı)
# proxy_cache_path /var/cache/nginx/alo17 levels=1:2 keys_zone=alo17_cache:10m max_size=1g inactive=60m use_temp_path=off;

server {
    listen 80;
    listen [::]:80;
    server_name alo17.tr www.alo17.tr;

    # ... mevcut ayarlarınız ...

    # Cache zone (eğer nginx.conf'da tanımlı değilse)
    # proxy_cache_path /var/cache/nginx/alo17 levels=1:2 keys_zone=alo17_cache:10m max_size=1g inactive=60m use_temp_path=off;

    # Static dosyalar için agresif cache
    location /_next/static {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache alo17_cache;
        proxy_cache_valid 200 365d;
        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
        proxy_cache_background_update on;
        proxy_cache_lock on;
        add_header Cache-Control "public, max-age=31536000, immutable";
        add_header X-Cache-Status $upstream_cache_status;
        expires 1y;
        access_log off;
    }

    # Image optimization cache
    location /_next/image {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache alo17_cache;
        proxy_cache_valid 200 7d;
        proxy_cache_use_stale error timeout;
        add_header X-Cache-Status $upstream_cache_status;
    }

    # API cache (dikkatli kullanın - sadece read-only endpoint'ler için)
    location ~ ^/api/listings/(homepage|category) {
        proxy_pass http://127.0.0.1:3000;
        proxy_cache alo17_cache;
        proxy_cache_valid 200 5m;
        proxy_cache_use_stale error timeout;
        proxy_cache_key "$scheme$request_method$host$request_uri";
        add_header X-Cache-Status $upstream_cache_status;
    }

    # Gzip optimization
    gzip on;
    gzip_vary on;
    gzip_min_length 256;
    gzip_comp_level 6;
    gzip_proxied any;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/rss+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;
    gzip_disable "msie6";

    # ... diğer location blokları ...
}

